var commentTemplate='<div class="comment-infos"><div class="comment-user">@@commenter@@</div><div class="comment-text">{{comment}}</div><div class="comment-date">{{created_at}}</div></div>',commentSerialize=function(){var e="";e+="post_id="+document.getElementById("post-id").value,e+="&comment="+document.getElementById("comment-area").value,e+="&parent_id=0",submitComment(e)},imageSerialize=function(e){var t=e.files[0],n=e.getAttribute("data-processing-type");submitImage(t,n)},submitComment=function(e){var t=new XMLHttpRequest;t.open("POST",document.getElementById("comment-area-wrapper").getAttribute("action"),!0),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.addEventListener("error",onError,!1),t.addEventListener("progress",onProgress,!1),t.onreadystatechange=function(){var e,n;if(e=4,n=200,4==t.readyState&&200==t.status){var a=JSON.parse(t.responseText);if(a&&a.comment&&a.commenter){for(var o=commentTemplate,s=a.comment,m=a.commenter;o.match(/(?:\{{2})(\w{1,50})+(?:\}{2})/);)if(key=o.match(/(?:\{{2})(\w{1,50})+(?:\}{2})/)[1],"created_at"===key){var r=s[key],i="",d=["JAN","FAB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"];i=""+d[(r.match(/(?:\d{4}-)(\d{2})(?:-\d{2})+/)[1]>>0)-1]+" "+r.match(/(?:\d{4}-\d{2}-)(\d{2})/)[1]+". "+r.match(/(\d{4})(?:-\d{2}-\d{2})/)[1],o=o.replace(/(?:\{{2})(\w{1,50})+(?:\}{2})/,i)}else o=o.replace(/(?:\{{2})(\w{1,50})+(?:\}{2})/,s[key]);for(;o.match(/(?:\@{2})(\w{1,50})+(?:\@{2})/);)o=o.replace(/(?:\@{2})(\w{1,50})+(?:\@{2})/,m);document.getElementById("comments-list").insertAdjacentHTML("afterbegin",o),document.getElementById("comments-count").innerHTML=(document.getElementById("comments-count").innerHTML>>0)+1}}},t.send(e)},submitImage=function(e,t){var n=new XMLHttpRequest,a=e.name.match(/\.\w{1,5}/g)[e.name.match(/\.\w{1,5}/g).length-1];n.open("POST","/images/new?processing_type="+t+"&file_type="+a,!0),n.setRequestHeader("Content-Type","application/octet-stream"),n.addEventListener("error",onError,!1),n.addEventListener("progress",onProgress,!1),n.onreadystatechange=function(){var e,a;if(e=4,a=200,4==n.readyState&&200==n.status){var o=JSON.parse(n.responseText);o&&(t>>0===1?document.getElementById("thumbnail").value=o.thumbnail:t>>0===2&&(document.getElementById("background_image").value=o.background))}},n.send(e)},onProgress=function(e){if(e.lengthComputable){e.loaded/e.total*100}},onError=function(e){},imageUpload=function(e){var t,n,a;if(t=e,a=t.parentNode,n=document.createElement("input"),n.setAttribute("class",t.getAttribute("class")),n.setAttribute("id",t.getAttribute("id")),n.setAttribute("name",t.getAttribute("name")),n.setAttribute("type",t.getAttribute("type")),t.files&&t.files[0]){var o,s,m,r;o=t.files[0],s=/image.*/,m=o.name,r=new FileReader,r.onload=function(e){var o,s,m;o=document.createElement("img"),o.src=e.target.result,s=o.width,m=o.height,2>s?(alert("파일의 최소 가로 길이는 200px입니다."),a.removeChild(t),a.appendChild(n)):2>m?(alert("파일의 최소 세로 길이는 200px입니다."),a.removeChild(t),a.appendChild(n)):(imageSerialize(t),document.querySelectorAll('img[data-targetted-image="'+t.getAttribute("id")+'"]')[0].src=e.target.result)},r.readAsDataURL(o)}},ready=function(){var e=jj(".tags a.tag"),t=(jj(".post a"),jj(".post a.pull-left")),n=jj(".post-title-link"),a=jj(".post-category-link");if(document.getElementById("comment-submit")&&addEvent(document.getElementById("comment-submit"),"click",function(){commentSerialize()}),document.getElementsByClassName("image-upload").length)for(var o=document.getElementsByClassName("image-upload"),s=0;s<o.length;s++)addEvent(o[s],"change",function(e){imageUpload(this)});document.getElementsByClassName("post-category-selector").length&&addEvent(document.getElementsByClassName("post-category-selector")[0],"change",function(e){ga("send","event","포스트 리스트","Button Press","카테고리 변경 - "+this.options[this.selectedIndex].text),e.target.value>>0===0?window.location.href="/posts":window.location.href="/posts/categories/"+e.target.value}),document.getElementById("post-search-submit")&&addEvent(document.getElementById("post-search-submit"),"click",function(e){document.getElementById("post-search-form").submit()});for(var m=0,r=e.length;r>m;m++)addEvent(e[m],"click",function(){ga("send","event","포스트 상세","Button Press","포스트 태그 클릭 - "+this.textContent.trim())});for(var i=0,d=t.length;d>i;i++)addEvent(t[i],"click",function(){ga("send","event","포스트 리스트","Button Press","포스트 클릭 - ["+this.parentNode.getElementsByClassName("post-category-name")[0].textContent.trim()+"] "+this.parentNode.getElementsByClassName("post-title")[0].textContent.trim())});for(var c=0,l=n.length;l>c;c++)addEvent(n[c],"click",function(){ga("send","event","포스트 리스트","Button Press","포스트 클릭 - ["+this.parentNode.getElementsByClassName("post-category-name")[0].textContent.trim()+"] "+this.getElementsByTagName("div")[0].textContent.trim())});for(var u=0,g=a.length;g>u;u++)addEvent(a[u],"click",function(){ga("send","event","포스트 리스트","Button Press","포스트 카테고리 클릭 - "+this.getElementsByTagName("span")[0].textContent.trim())})};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBvc3RzLm1pbi5qcyJdLCJuYW1lcyI6WyJjb21tZW50VGVtcGxhdGUiLCJjb21tZW50U2VyaWFsaXplIiwiZGF0YSIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJ2YWx1ZSIsInN1Ym1pdENvbW1lbnQiLCJpbWFnZVNlcmlhbGl6ZSIsImVsZW1lbnQiLCJmaWxlcyIsInByb2Nlc3NpbmdUeXBlIiwiZ2V0QXR0cmlidXRlIiwic3VibWl0SW1hZ2UiLCJ4aHIiLCJYTUxIdHRwUmVxdWVzdCIsIm9wZW4iLCJzZXRSZXF1ZXN0SGVhZGVyIiwiYWRkRXZlbnRMaXN0ZW5lciIsIm9uRXJyb3IiLCJvblByb2dyZXNzIiwib25yZWFkeXN0YXRlY2hhbmdlIiwiRE9ORSIsIk9LIiwicmVhZHlTdGF0ZSIsInN0YXR1cyIsInJlc3VsdCIsIkpTT04iLCJwYXJzZSIsInJlc3BvbnNlVGV4dCIsImNvbW1lbnQiLCJjb21tZW50ZXIiLCJ0ZW1wbGF0ZSIsIm1hdGNoIiwia2V5IiwiZGF0ZSIsImRhdGVTdHIiLCJtb250aFN0ckFyciIsInJlcGxhY2UiLCJpbnNlcnRBZGphY2VudEhUTUwiLCJpbm5lckhUTUwiLCJzZW5kIiwiZmlsZVR5cGUiLCJuYW1lIiwibGVuZ3RoIiwidGh1bWJuYWlsIiwiYmFja2dyb3VuZCIsImUiLCJsZW5ndGhDb21wdXRhYmxlIiwibG9hZGVkIiwidG90YWwiLCJpbWFnZVVwbG9hZCIsInRhcmdldCIsInRhcmdldENsb25lIiwidGFyZ2V0UGFyZW50IiwicGFyZW50Tm9kZSIsImNyZWF0ZUVsZW1lbnQiLCJzZXRBdHRyaWJ1dGUiLCJpbWFnZUZpbGUiLCJpbWFnZVR5cGUiLCJpbWFnZU5hbWUiLCJyZWFkZXIiLCJGaWxlUmVhZGVyIiwib25sb2FkIiwiaW1hZ2UiLCJ3IiwiaCIsInNyYyIsIndpZHRoIiwiaGVpZ2h0IiwiYWxlcnQiLCJyZW1vdmVDaGlsZCIsImFwcGVuZENoaWxkIiwicXVlcnlTZWxlY3RvckFsbCIsInJlYWRBc0RhdGFVUkwiLCJyZWFkeSIsInBvc3RUYWdzIiwiamoiLCJwb3N0SW1hZ2VzIiwicG9zdFRleHRzIiwicG9zdENhdGVnb3JpZXMiLCJhZGRFdmVudCIsImdldEVsZW1lbnRzQnlDbGFzc05hbWUiLCJ1cGxvYWRlcnMiLCJpIiwidGhpcyIsImdhIiwib3B0aW9ucyIsInNlbGVjdGVkSW5kZXgiLCJ0ZXh0Iiwid2luZG93IiwibG9jYXRpb24iLCJocmVmIiwic3VibWl0IiwidGFnQ291bnRlciIsInRhZ0xlbmd0aCIsInRleHRDb250ZW50IiwidHJpbSIsInBvc3RJbWFnZUNvdW50ZXIiLCJwb3N0SW1hZ2VMZW5ndGgiLCJwb3N0VGV4dENvdW50ZXIiLCJwb3N0VGV4dExlbmd0aCIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwicG9zdENhdGVnb3J5Q291bnRlciIsInBvc3RDYXRlZ29yeUxlbmd0aCJdLCJtYXBwaW5ncyI6IkFBQUEsR0FBSUEsaUJBQWtCLDBLQU9sQkMsaUJBQW1CLFdBQ3JCLEdBQUlDLEdBQU8sRUFFWEEsSUFBUSxXQUFhQyxTQUFTQyxlQUFlLFdBQVdDLE1BQ3hESCxHQUFRLFlBQWNDLFNBQVNDLGVBQWUsZ0JBQWdCQyxNQUM5REgsR0FBUSxlQUVSSSxjQUFjSixJQUdaSyxlQUFpQixTQUFVQyxHQUM3QixHQUFJTixHQUFPTSxFQUFRQyxNQUFNLEdBQ3JCQyxFQUFpQkYsRUFBUUcsYUFBYSx1QkFFMUNDLGFBQVlWLEVBQU1RLElBR2hCSixjQUFnQixTQUFVSixHQUM1QixHQUFJVyxHQUFNLEdBQUlDLGVBRWRELEdBQUlFLEtBQUssT0FBUVosU0FBU0MsZUFBZSx3QkFBd0JPLGFBQWEsV0FBVyxHQUN6RkUsRUFBSUcsaUJBQWlCLGVBQWdCLHFDQUNyQ0gsRUFBSUksaUJBQWlCLFFBQVNDLFNBQVMsR0FDdkNMLEVBQUlJLGlCQUFpQixXQUFZRSxZQUFZLEdBQzdDTixFQUFJTyxtQkFBcUIsV0FDdkIsR0FBSUMsR0FBTUMsQ0FLVixJQUhBRCxFQUFPLEVBQ1BDLEVBQUssSUFFaUIsR0FBbEJULEVB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ZXNDb250ZW50IjpbInZhciBjb21tZW50VGVtcGxhdGUgPSAnJyArXG4gICAgJzxkaXYgY2xhc3M9XCJjb21tZW50LWluZm9zXCI+JyArXG4gICAgJzxkaXYgY2xhc3M9XCJjb21tZW50LXVzZXJcIj5AQGNvbW1lbnRlckBAPC9kaXY+JyArXG4gICAgJzxkaXYgY2xhc3M9XCJjb21tZW50LXRleHRcIj57e2NvbW1lbnR9fTwvZGl2PicgK1xuICAgICc8ZGl2IGNsYXNzPVwiY29tbWVudC1kYXRlXCI+e3tjcmVhdGVkX2F0fX08L2Rpdj4nICtcbiAgICAnPC9kaXY+JztcblxudmFyIGNvbW1lbnRTZXJpYWxpemUgPSBmdW5jdGlvbiAoKSB7XG4gIHZhciBkYXRhID0gJyc7XG5cbiAgZGF0YSArPSAncG9zdF9pZD0nICsgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Bvc3QtaWQnKS52YWx1ZTtcbiAgZGF0YSArPSAnJmNvbW1lbnQ9JyArIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb21tZW50LWFyZWEnKS52YWx1ZTtcbiAgZGF0YSArPSAnJnBhcmVudF9pZD0nICsgMDtcblxuICBzdWJtaXRDb21tZW50KGRhdGEpO1xufTtcblxudmFyIGltYWdlU2VyaWFsaXplID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgdmFyIGRhdGEgPSBlbGVtZW50LmZpbGVzWzBdO1xuICB2YXIgcHJvY2Vzc2luZ1R5cGUgPSBlbGVtZW50LmdldEF0dHJpYnV0ZSgnZGF0YS1wcm9jZXNzaW5nLXR5cGUnKTtcblxuICBzdWJtaXRJbWFnZShkYXRhLCBwcm9jZXNzaW5nVHlwZSk7XG59O1xuXG52YXIgc3VibWl0Q29tbWVudCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gIHZhciB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcblxuICB4aHIub3BlbignUE9TVCcsIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb21tZW50LWFyZWEtd3JhcHBlcicpLmdldEF0dHJpYnV0ZSgnYWN0aW9uJyksIHRydWUpO1xuICB4aHIuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCcpO1xuICB4aHIuYWRkRXZlbnRMaXN0ZW5lcignZXJyb3InLCBvbkVycm9yLCBmYWxzZSk7XG4gIHhoci5hZGRFdmVudExpc3RlbmVyKCdwcm9ncmVzcycsIG9uUHJvZ3Jlc3MsIGZhbHNlKTtcbiAgeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgRE9ORSwgT0s7XG5cbiAgICBET05FID0gNDtcbiAgICBPSyA9IDIwMDtcblxuICAgIGlmICh4aHIucmVhZHlTdGF0ZSAhPSA0IHx8IHhoci5zdGF0dXMgIT0gMjAwKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdmFyIHJlc3VsdCA9IEpTT04ucGFyc2UoeGhyLnJlc3BvbnNlVGV4dCk7XG5cbiAgICBpZiAocmVzdWx0ICYmIHJlc3VsdC5jb21tZW50ICYmIHJlc3VsdC5jb21tZW50ZXIpIHtcbiAgICAgIHZhciB0ZW1wbGF0ZSA9IGNvbW1lbnRUZW1wbGF0ZTtcbiAgICAgIHZhciBjb21tZW50ID0gcmVzdWx0LmNvbW1lbnQ7XG4gICAgICB2YXIgY29tbWVudGVyID0gcmVzdWx0LmNvbW1lbnRlcjtcblxuICAgICAgd2hpbGUgKHRlbXBsYXRlLm1hdGNoKC8oPzpcXHt7Mn0pKFxcd3sxLDUwfSkrKD86XFx9ezJ9KS8pKSB7XG4gICAgICAgIGtleSA9IHRlbXBsYXRlLm1hdGNoKC8oPzpcXHt7Mn0pKFxcd3sxLDUwfSkrKD86XFx9ezJ9KS8pWzFdO1xuICAgICAgICBpZiAoa2V5ID09PSAnY3JlYXRlZF9hdCcpIHtcbiAgICAgICAgICB2YXIgZGF0ZSA9IGNvbW1lbnRba2V5XTtcbiAgICAgICAgICB2YXIgZGF0ZVN0ciA9ICcnO1xuICAgICAgICAgIHZhciBtb250aFN0ckFyciA9IFsnSkFOJywgJ0ZBQicsICdNQVInLCAnQVBSJywgJ01BWScsICdKVU4nLCAnSlVMJywgJ0FVRycsICdTRVAnLCAnT0NUJywgJ05PVicsICdERUMnXTtcbiAgICAgICAgICBkYXRlU3RyID0gJycgK1xuICAgICAgICAgICAgICBtb250aFN0ckFyclsoZGF0ZS5tYXRjaCgvKD86XFxkezR9LSkoXFxkezJ9KSg/Oi1cXGR7Mn0pKy8pWzFdID4+IDApIC0gMV0gKyAnICcgK1xuICAgICAgICAgICAgICBkYXRlLm1hdGNoKC8oPzpcXGR7NH0tXFxkezJ9LSkoXFxkezJ9KS8pWzFdICsgJy4gJyArXG4gICAgICAgICAgICAgIGRhdGUubWF0Y2goLyhcXGR7NH0pKD86LVxcZHsyfS1cXGR7Mn0pLylbMV07XG4gICAgICAgICAgdGVtcGxhdGUgPSB0ZW1wbGF0ZS5yZXBsYWNlKC8oPzpcXHt7Mn0pKFxcd3sxLDUwfSkrKD86XFx9ezJ9KS8sIGRhdGVTdHIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRlbXBsYXRlID0gdGVtcGxhdGUucmVwbGFjZSgvKD86XFx7ezJ9KShcXHd7MSw1MH0pKyg/OlxcfXsyfSkvLCBjb21tZW50W2tleV0pO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHdoaWxlICh0ZW1wbGF0ZS5tYXRjaCgvKD86XFxAezJ9KShcXHd7MSw1MH0pKyg/OlxcQHsyfSkvKSkge1xuICAgICAgICB0ZW1wbGF0ZSA9IHRlbXBsYXRlLnJlcGxhY2UoLyg/OlxcQHsyfSkoXFx3ezEsNTB9KSsoPzpcXEB7Mn0pLywgY29tbWVudGVyKTtcbiAgICAgIH1cblxuICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbW1lbnRzLWxpc3QnKS5pbnNlcnRBZGphY2VudEhUTUwoJ2FmdGVyYmVnaW4nLCB0ZW1wbGF0ZSk7XG4gICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29tbWVudHMtY291bnQnKS5pbm5lckhUTUwgPSAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbW1lbnRzLWNvdW50JykuaW5uZXJIVE1MID4+IDApICsgMTtcbiAgICB9XG4gIH07XG5cbiAgeGhyLnNlbmQoZGF0YSk7XG59O1xuXG52YXIgc3VibWl0SW1hZ2UgPSBmdW5jdGlvbiAoZGF0YSwgcHJvY2Vzc2luZ1R5cGUpIHtcbiAgdmFyIHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuICB2YXIgZmlsZVR5cGUgPSBkYXRhLm5hbWUubWF0Y2goL1xcLlxcd3sxLDV9L2cpW2RhdGEubmFtZS5tYXRjaCgvXFwuXFx3ezEsNX0vZykubGVuZ3RoIC0gMV07XG5cbiAgeGhyLm9wZW4oJ1BPU1QnLCAnL2ltYWdlcy9uZXc/cHJvY2Vzc2luZ190eXBlPScgKyBwcm9jZXNzaW5nVHlwZSArICcmZmlsZV90eXBlPScgKyBmaWxlVHlwZSwgdHJ1ZSk7XG4gIHhoci5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJyk7XG4gIHhoci5hZGRFdmVudExpc3RlbmVyKCdlcnJvcicsIG9uRXJyb3IsIGZhbHNlKTtcbiAgeGhyLmFkZEV2ZW50TGlzdGVuZXIoJ3Byb2dyZXNzJywgb25Qcm9ncmVzcywgZmFsc2UpO1xuICB4aHIub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBET05FLCBPSztcblxuICAgIERPTkUgPSA0O1xuICAgIE9LID0gMjAwO1xuXG4gICAgaWYgKHhoci5yZWFkeVN0YXRlICE9IDQgfHwgeGhyLnN0YXR1cyAhPSAyMDApIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB2YXIgcmVzdWx0ID0gSlNPTi5wYXJzZSh4aHIucmVzcG9uc2VUZXh0KTtcblxuICAgIGlmIChyZXN1bHQpIHtcbiAgICAgIGlmIChwcm9jZXNzaW5nVHlwZSA+PiAwID09PSAxKSB7XG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0aHVtYm5haWwnKS52YWx1ZSA9IHJlc3VsdC50aHVtYm5haWw7XG4gICAgICB9IGVsc2UgaWYgKHByb2Nlc3NpbmdUeXBlID4+IDAgPT09IDIpIHtcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JhY2tncm91bmRfaW1hZ2UnKS52YWx1ZSA9IHJlc3VsdC5iYWNrZ3JvdW5kO1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICB4aHIuc2VuZChkYXRhKTtcbn07XG5cbnZhciBvblByb2dyZXNzID0gZnVuY3Rpb24gKGUpIHtcbiAgLy8gY29uc29sZS5sb2coZSk7XG4gIGlmIChlLmxlbmd0aENvbXB1dGFibGUpIHtcbiAgICB2YXIgcGVyY2VudENvbXBsZXRlID0gKGUubG9hZGVkIC8gZS50b3RhbCkgKiAxMDA7XG4gIH1cbn07XG5cbnZhciBvbkVycm9yID0gZnVuY3Rpb24gKGUpIHtcbiAgLy8gY29uc29sZS5sb2coZSk7XG59O1xuXG52YXIgaW1hZ2VVcGxvYWQgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xuICB2YXIgdGFyZ2V0LCB0YXJnZXRDbG9uZSwgdGFyZ2V0UGFyZW50O1xuXG4gIHRhcmdldCA9IGVsZW1lbnQ7XG4gIHRhcmdldFBhcmVudCA9IHRhcmdldC5wYXJlbnROb2RlO1xuICB0YXJnZXRDbG9uZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7XG5cbiAgdGFyZ2V0Q2xvbmUuc2V0QXR0cmlidXRlKCdjbGFzcycsIHRhcmdldC5nZXRBdHRyaWJ1dGUoJ2NsYXNzJykpO1xuICB0YXJnZXRDbG9uZS5zZXRBdHRyaWJ1dGUoJ2lkJywgdGFyZ2V0LmdldEF0dHJpYnV0ZSgnaWQnKSk7XG4gIHRhcmdldENsb25lLnNldEF0dHJpYnV0ZSgnbmFtZScsIHRhcmdldC5nZXRBdHRyaWJ1dGUoJ25hbWUnKSk7XG4gIHRhcmdldENsb25lLnNldEF0dHJpYnV0ZSgndHlwZScsIHRhcmdldC5nZXRBdHRyaWJ1dGUoJ3R5cGUnKSk7XG5cbiAgaWYgKHRhcmdldC5maWxlcyAmJiB0YXJnZXQuZmlsZXNbMF0pIHtcbiAgICB2YXIgaW1hZ2VGaWxlLCBpbWFnZVR5cGUsIGltYWdlTmFtZTtcbiAgICB2YXIgcmVhZGVyO1xuXG4gICAgaW1hZ2VGaWxlID0gdGFyZ2V0LmZpbGVzWzBdO1xuICAgIGltYWdlVHlwZSA9IC9pbWFnZS4qLztcbiAgICBpbWFnZU5hbWUgPSBpbWFnZUZpbGUubmFtZTtcbiAgICByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xuXG4gICAgcmVhZGVyLm9ubG9hZCA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICB2YXIgYmluYXJ5RGF0YSwgaW1hZ2UsIHcsIGg7XG4gICAgICBpbWFnZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpO1xuICAgICAgaW1hZ2Uuc3JjID0gZS50YXJnZXQucmVzdWx0O1xuICAgICAgdyA9IGltYWdlLndpZHRoO1xuICAgICAgaCA9IGltYWdlLmhlaWdodDtcblxuICAgICAgaWYgKHcgPCAyKSB7XG4gICAgICAgIGFsZXJ0KCftjIzsnbzsnZgg7LWc7IaMIOqwgOuhnCDquLjsnbTripQgMjAwcHjsnoXri4jri6QuJyk7XG4gICAgICAgIHRhcmdldFBhcmVudC5yZW1vdmVDaGlsZCh0YXJnZXQpO1xuICAgICAgICB0YXJnZXRQYXJlbnQuYXBwZW5kQ2hpbGQodGFyZ2V0Q2xvbmUpO1xuICAgICAgfSBlbHNlIGlmIChoIDwgMikge1xuICAgICAgICBhbGVydCgn7YyM7J287J2YIOy1nOyGjCDshLjroZwg6ri47J2064qUIDIwMHB47J6F64uI64ukLicpO1xuICAgICAgICB0YXJnZXRQYXJlbnQucmVtb3ZlQ2hpbGQodGFyZ2V0KTtcbiAgICAgICAgdGFyZ2V0UGFyZW50LmFwcGVuZENoaWxkKHRhcmdldENsb25lKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGltYWdlU2VyaWFsaXplKHRhcmdldCk7XG4gICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2ltZ1tkYXRhLXRhcmdldHRlZC1pbWFnZT1cIicgKyB0YXJnZXQuZ2V0QXR0cmlidXRlKCdpZCcpICsgJ1wiXScpWzBdLnNyYyA9IGUudGFyZ2V0LnJlc3VsdDtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoaW1hZ2VGaWxlKTtcbiAgfVxufTtcblxudmFyIHJlYWR5ID0gZnVuY3Rpb24gKCkge1xuICB2YXIgcG9zdFRhZ3MgPSBqaignLnRhZ3MgYS50YWcnKSxcbiAgICAgIHBvc3RzID0gamooJy5wb3N0IGEnKSxcbiAgICAgIHBvc3RJbWFnZXMgPSBqaignLnBvc3QgYS5wdWxsLWxlZnQnKSxcbiAgICAgIHBvc3RUZXh0cyA9IGpqKCcucG9zdC10aXRsZS1saW5rJyksXG4gICAgICBwb3N0Q2F0ZWdvcmllcyA9IGpqKCcucG9zdC1jYXRlZ29yeS1saW5rJyk7XG5cbiAgaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb21tZW50LXN1Ym1pdCcpKSB7XG4gICAgYWRkRXZlbnQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbW1lbnQtc3VibWl0JyksICdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbW1lbnRTZXJpYWxpemUoKTtcbiAgICB9KTtcbiAgfVxuXG4gIGlmIChkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdpbWFnZS11cGxvYWQnKS5sZW5ndGgpIHtcbiAgICB2YXIgdXBsb2FkZXJzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnaW1hZ2UtdXBsb2FkJyk7XG5cbiAgICB2YXIgaSA9IDA7XG4gICAgZm9yICg7IGkgPCB1cGxvYWRlcnMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGFkZEV2ZW50KHVwbG9hZGVyc1tpXSwgJ2NoYW5nZScsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGltYWdlVXBsb2FkKHRoaXMpO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgaWYgKGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ3Bvc3QtY2F0ZWdvcnktc2VsZWN0b3InKS5sZW5ndGgpIHtcbiAgICBhZGRFdmVudChkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdwb3N0LWNhdGVnb3J5LXNlbGVjdG9yJylbMF0sICdjaGFuZ2UnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgZ2EoJ3NlbmQnLCAnZXZlbnQnLCAn7Y+s7Iqk7Yq4IOumrOyKpO2KuCcsICdCdXR0b24gUHJlc3MnLCAn7Lm07YWM6rOg66asIOuzgOqyvSAtICcgK1xuICAgICAgICAgIHRoaXMub3B0aW9uc1t0aGlzLnNlbGVjdGVkSW5kZXhdLnRleHQpO1xuXG4gICAgICBpZiAoZS50YXJnZXQudmFsdWUgPj4gMCA9PT0gMCkge1xuICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9ICcvcG9zdHMnO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSAnL3Bvc3RzL2NhdGVnb3JpZXMvJyArIGUudGFyZ2V0LnZhbHVlO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwb3N0LXNlYXJjaC1zdWJtaXQnKSkge1xuICAgIGFkZEV2ZW50KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwb3N0LXNlYXJjaC1zdWJtaXQnKSwgJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwb3N0LXNlYXJjaC1mb3JtJykuc3VibWl0KCk7XG4gICAgfSk7XG4gIH1cblxuICB2YXIgdGFnQ291bnRlciA9IDAsIHRhZ0xlbmd0aCA9IHBvc3RUYWdzLmxlbmd0aDtcbiAgZm9yICg7IHRhZ0NvdW50ZXIgPCB0YWdMZW5ndGg7IHRhZ0NvdW50ZXIrKykge1xuICAgIGFkZEV2ZW50KHBvc3RUYWdzW3RhZ0NvdW50ZXJdLCAnY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICBnYSgnc2VuZCcsICdldmVudCcsICftj6zsiqTtirgg7IOB7IS4JywgJ0J1dHRvbiBQcmVzcycsICftj6zsiqTtirgg7YOc6re4IO2BtOumrScgKyAnIC0gJyArIHRoaXMudGV4dENvbnRlbnQudHJpbSgpKTtcbiAgICB9KTtcbiAgfVxuXG4gIHZhciBwb3N0SW1hZ2VDb3VudGVyID0gMCwgcG9zdEltYWdlTGVuZ3RoID0gcG9zdEltYWdlcy5sZW5ndGg7XG4gIGZvciAoOyBwb3N0SW1hZ2VDb3VudGVyIDwgcG9zdEltYWdlTGVuZ3RoOyBwb3N0SW1hZ2VDb3VudGVyKyspIHtcbiAgICBhZGRFdmVudChwb3N0SW1hZ2VzW3Bvc3RJbWFnZUNvdW50ZXJdLCAnY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICBnYSgnc2VuZCcsICdldmVudCcsICftj6zsiqTtirgg66as7Iqk7Yq4JywgJ0J1dHRvbiBQcmVzcycsICftj6zsiqTtirgg7YG066atIC0gWycgK1xuICAgICAgICAgIHRoaXMucGFyZW50Tm9kZS5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdwb3N0LWNhdGVnb3J5LW5hbWUnKVswXS50ZXh0Q29udGVudC50cmltKCkgKyAnXSAnICtcbiAgICAgICAgICB0aGlzLnBhcmVudE5vZGUuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgncG9zdC10aXRsZScpWzBdLnRleHRDb250ZW50LnRyaW0oKSk7XG4gICAgfSk7XG4gIH1cblxuICB2YXIgcG9zdFRleHRDb3VudGVyID0gMCwgcG9zdFRleHRMZW5ndGggPSBwb3N0VGV4dHMubGVuZ3RoO1xuICBmb3IgKDsgcG9zdFRleHRDb3VudGVyIDwgcG9zdFRleHRMZW5ndGg7IHBvc3RUZXh0Q291bnRlcisrKSB7XG4gICAgYWRkRXZlbnQocG9zdFRleHRzW3Bvc3RUZXh0Q291bnRlcl0sICdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGdhKCdzZW5kJywgJ2V2ZW50JywgJ+2PrOyKpO2KuCDrpqzsiqTtirgnLCAnQnV0dG9uIFByZXNzJywgJ+2PrOyKpO2KuCDtgbTrpq0gLSBbJyArXG4gICAgICAgICAgdGhpcy5wYXJlbnROb2RlLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ3Bvc3QtY2F0ZWdvcnktbmFtZScpWzBdLnRleHRDb250ZW50LnRyaW0oKSArICddICcgK1xuICAgICAgICAgIHRoaXMuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2RpdicpWzBdLnRleHRDb250ZW50LnRyaW0oKSk7XG4gICAgfSk7XG4gIH1cblxuICB2YXIgcG9zdENhdGVnb3J5Q291bnRlciA9IDAsIHBvc3RDYXRlZ29yeUxlbmd0aCA9IHBvc3RDYXRlZ29yaWVzLmxlbmd0aDtcbiAgZm9yICg7IHBvc3RDYXRlZ29yeUNvdW50ZXIgPCBwb3N0Q2F0ZWdvcnlMZW5ndGg7IHBvc3RDYXRlZ29yeUNvdW50ZXIrKykge1xuICAgIGFkZEV2ZW50KHBvc3RDYXRlZ29yaWVzW3Bvc3RDYXRlZ29yeUNvdW50ZXJdLCAnY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICBnYSgnc2VuZCcsICdldmVudCcsICftj6zsiqTtirgg66as7Iqk7Yq4JywgJ0J1dHRvbiBQcmVzcycsICftj6zsiqTtirgg7Lm07YWM6rOg66asIO2BtOumrSAtICcgK1xuICAgICAgICAgIHRoaXMuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3NwYW4nKVswXS50ZXh0Q29udGVudC50cmltKCkpO1xuICAgIH0pO1xuICB9XG59O1xuXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=

var commentTemplate='<div class="comment-infos"><div class="comment-user">@@commenter@@</div><div class="comment-text">{{comment}}</div><div class="comment-date">{{created_at}}</div></div>',commentSerialize=function(){var e="";e+="post_id="+document.getElementById("post-id").value,e+="&comment="+document.getElementById("comment-area").value,e+="&parent_id=0",submitComment(e)},imageSerialize=function(e){var t=e.files[0],n=e.getAttribute("data-processing-type");submitImage(t,n)},submitComment=function(e){var t=new XMLHttpRequest;t.open("POST",document.getElementById("comment-area-wrapper").getAttribute("action"),!0),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.addEventListener("error",onError,!1),t.addEventListener("progress",onProgress,!1),t.onreadystatechange=function(){var e,n;if(e=4,n=200,4==t.readyState&&200==t.status){var a=JSON.parse(t.responseText);if(a&&a.comment&&a.commenter){for(var m=commentTemplate,o=a.comment,r=a.commenter;m.match(/(?:\{{2})(\w{1,50})+(?:\}{2})/);)if(key=m.match(/(?:\{{2})(\w{1,50})+(?:\}{2})/)[1],"created_at"===key){var i=o[key],c="",d=["JAN","FAB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"];c=""+d[(i.match(/(?:\d{4}-)(\d{2})(?:-\d{2})+/)[1]>>0)-1]+" "+i.match(/(?:\d{4}-\d{2}-)(\d{2})/)[1]+". "+i.match(/(\d{4})(?:-\d{2}-\d{2})/)[1],m=m.replace(/(?:\{{2})(\w{1,50})+(?:\}{2})/,c)}else m=m.replace(/(?:\{{2})(\w{1,50})+(?:\}{2})/,o[key]);for(;m.match(/(?:\@{2})(\w{1,50})+(?:\@{2})/);)m=m.replace(/(?:\@{2})(\w{1,50})+(?:\@{2})/,r);document.getElementById("comments-list").insertAdjacentHTML("afterbegin",m),document.getElementById("comments-count").innerHTML=(document.getElementById("comments-count").innerHTML>>0)+1}}},t.send(e)},submitImage=function(e,t){var n=new XMLHttpRequest,a=e.name.match(/\.\w{1,5}/g)[e.name.match(/\.\w{1,5}/g).length-1];n.open("POST","/images/new?processing_type="+t+"&file_type="+a,!0),n.setRequestHeader("Content-Type","application/octet-stream"),n.addEventListener("error",onError,!1),n.addEventListener("progress",onProgress,!1),n.onreadystatechange=function(){var e,a;if(e=4,a=200,4==n.readyState&&200==n.status){var m=JSON.parse(n.responseText);m&&(t>>0===1?document.getElementById("thumbnail").value=m.thumbnail:t>>0===2&&(document.getElementById("background_image").value=m.background))}},n.send(e)},onProgress=function(e){if(e.lengthComputable){e.loaded/e.total*100}},onError=function(e){},imageUpload=function(e){var t,n,a;if(t=e,a=t.parentNode,n=document.createElement("input"),n.setAttribute("class",t.getAttribute("class")),n.setAttribute("id",t.getAttribute("id")),n.setAttribute("name",t.getAttribute("name")),n.setAttribute("type",t.getAttribute("type")),t.files&&t.files[0]){var m,o,r,i;m=t.files[0],o=/image.*/,r=m.name,i=new FileReader,i.onload=function(e){var m,o,r;m=document.createElement("img"),m.src=e.target.result,o=m.width,r=m.height,2>o?(alert("파일의 최소 가로 길이는 200px입니다."),a.removeChild(t),a.appendChild(n)):2>r?(alert("파일의 최소 세로 길이는 200px입니다."),a.removeChild(t),a.appendChild(n)):(imageSerialize(t),document.querySelectorAll('img[data-targetted-image="'+t.getAttribute("id")+'"]')[0].src=e.target.result)},i.readAsDataURL(m)}},ready=function(){if(document.getElementById("comment-submit")&&addEvent(document.getElementById("comment-submit"),"click",function(){commentSerialize()}),document.getElementsByClassName("image-upload").length)for(var e=document.getElementsByClassName("image-upload"),t=0;t<e.length;t++)addEvent(e[t],"change",function(e){imageUpload(e.target)});document.getElementsByClassName("post-category-selector").length&&addEvent(document.getElementsByClassName("post-category-selector")[0],"change",function(e){e.target.value>>0===0?window.location.href="/posts":window.location.href="/posts/categories/"+e.target.value}),document.getElementById("post-search-submit")&&addEvent(document.getElementById("post-search-submit"),"click",function(e){document.getElementById("post-search-form").submit()})};